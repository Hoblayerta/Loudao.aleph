# LouDAO - Plataforma de Reportes Confidenciales con Tecnolog√≠a FHEVM

## üìã Descripci√≥n del Proyecto

**LouDAO** es una plataforma descentralizada para el reporte confidencial de casos de violencia, implementada con tecnolog√≠a blockchain y **Fully Homomorphic Encryption (FHE)** de **Zama**. La plataforma permite a las v√≠ctimas reportar incidentes de manera completamente an√≥nima y segura, manteniendo la privacidad de los datos sensibles mientras permite an√°lisis estad√≠sticos sobre los datos encriptados.

## üîê Integraci√≥n con Tecnolog√≠a Zama FHEVM

### ¬øQu√© es FHEVM?

**FHEVM (Fully Homomorphic Encryption Virtual Machine)** es la tecnolog√≠a desarrollada por Zama que permite realizar computaciones directamente sobre datos encriptados sin necesidad de descifrarlos. Esto significa que:

- ‚úÖ Los datos sensibles nunca se revelan en la blockchain
- ‚úÖ Se pueden realizar c√°lculos estad√≠sticos sobre datos encriptados
- ‚úÖ La privacidad se mantiene a nivel criptogr√°fico, no solo a nivel de aplicaci√≥n
- ‚úÖ Los smart contracts pueden procesar informaci√≥n confidencial de forma segura

### Arquitectura de Implementaci√≥n

El proyecto utiliza una **arquitectura h√≠brida** que combina:

#### 1. **Datos P√∫blicos** (No encriptados)
```solidity
struct PublicReport {
    string aggressor;      // Nombre del agresor
    string institution;   // Instituci√≥n involucrada
    string description;   // Descripci√≥n del caso
    uint256 year;         // A√±o del incidente
    uint256 timestamp;    // Momento del reporte
    uint256 reportId;     // ID √∫nico del reporte
}
```

#### 2. **Datos Privados** (Encriptados con FHE)
- **Edad de la v√≠ctima** (`euint32`)
- **Tipo de relaci√≥n** (`euint8`)
- **Tipo de violencia** (`euint8`)
- **Nivel de urgencia** (`euint8`)

### Smart Contract Principal: `LouDaoHybrid`

```solidity
// Importaci√≥n de la biblioteca FHEVM
import "./TFHE.sol";

contract LouDaoHybrid {
    // Variables para estad√≠sticas encriptadas
    bytes private totalAgeBytes;    // Suma total de edades (encriptada)
    bytes private ageCountBytes;    // Contador de reportes (encriptado)
    
    // Almacenamiento de datos privados como bytes encriptados
    mapping(uint256 => bytes) private privateData;
    
    function submitReport(
        string calldata _aggressor,
        string calldata _institution,
        string calldata _description,
        uint256 _year,
        bytes calldata _victimAgeBytes,      // Edad encriptada
        bytes calldata _relationshipTypeBytes, // Relaci√≥n encriptada
        bytes calldata _violenceTypeBytes,   // Tipo de violencia encriptado
        bytes calldata _urgencyLevelBytes,   // Urgencia encriptada
        bytes32 _reporterHash               // Hash del reportero
    ) external {
        // ... l√≥gica de validaci√≥n ...
        
        // Actualizar estad√≠sticas FHE
        _updateFheStatistics(_victimAgeBytes);
    }
}
```

## üèóÔ∏è Arquitectura del Sistema

### 1. **Frontend (React + TypeScript)**
```
client/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # Componentes de interfaz
‚îÇ   ‚îú‚îÄ‚îÄ pages/               # P√°ginas principales
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blockchain.ts    # Servicio de conexi√≥n blockchain
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fhe.ts          # Servicio de encriptaci√≥n FHE
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts        # Utilidades generales
‚îÇ   ‚îî‚îÄ‚îÄ hooks/              # Hooks personalizados
```

### 2. **Smart Contracts (Solidity)**
```
contracts/
‚îú‚îÄ‚îÄ LouDaoFinal.sol         # Contrato principal (sin FHE)
‚îú‚îÄ‚îÄ hybrid/
‚îÇ   ‚îú‚îÄ‚îÄ LouDaoHybrid.sol    # Contrato h√≠brido con FHE
‚îÇ   ‚îî‚îÄ‚îÄ TFHE.sol           # Mock de biblioteca FHE para desarrollo
‚îî‚îÄ‚îÄ [...otros contratos]
```

### 3. **Backend/Servidor (Express + TypeScript)**
```
server/
‚îú‚îÄ‚îÄ index.ts               # Servidor principal
‚îú‚îÄ‚îÄ routes.ts              # Rutas API
‚îî‚îÄ‚îÄ storage.ts             # Gesti√≥n de almacenamiento
```

## üîÑ Flujo de Funcionamiento

### 1. **Env√≠o de Reporte**

```mermaid
graph TD
    A[Usuario llena formulario] --> B[Frontend encripta datos sensibles]
    B --> C[Genera proof criptogr√°fico]
    C --> D[Env√≠a transacci√≥n al smart contract]
    D --> E[Contrato valida y almacena datos]
    E --> F[Actualiza estad√≠sticas FHE]
    F --> G[Emite eventos blockchain]
```

#### C√≥digo Frontend (FHE Service):
```typescript
export class FHEService {
  async encryptPrivateData(data: {
    victimAge?: string;
    relationshipType?: string;
    violenceType?: string;
    urgencyLevel?: string;
  }): Promise<EncryptedData> {
    // En producci√≥n, usar√≠a fhevmjs
    // await initFhevmjs();
    
    return {
      victimAge: this.fheEncrypt(parseInt(data.victimAge)),
      relationshipType: this.fheEncrypt(parseInt(data.relationshipType)),
      violenceType: this.fheEncrypt(parseInt(data.violenceType)),
      urgencyLevel: this.fheEncrypt(parseInt(data.urgencyLevel))
    };
  }
}
```

### 2. **Procesamiento de Estad√≠sticas FHE**

El smart contract puede realizar operaciones matem√°ticas sobre los datos encriptados:

```solidity
function _updateFheStatistics(bytes memory victimAgeBytes) private {
    // Decodificar valores encriptados
    TFHE.euint32 memory victimAge = TFHE.asEuint32FromBytes(victimAgeBytes);
    TFHE.euint32 memory currentTotal = TFHE.asEuint32FromBytes(totalAgeBytes);
    TFHE.euint32 memory currentCount = TFHE.asEuint32FromBytes(ageCountBytes);

    // Realizar operaciones FHE (sobre datos encriptados)
    TFHE.euint32 memory newTotal = TFHE.add(currentTotal, victimAge);
    TFHE.euint32 memory newCount = TFHE.add(currentCount, TFHE.asEuint32(1));

    // Almacenar resultados encriptados
    totalAgeBytes = TFHE.toBytes(newTotal);
    ageCountBytes = TFHE.toBytes(newCount);
}
```

### 3. **Detecci√≥n de Patrones**

El sistema puede detectar patrones sin revelar informaci√≥n individual:

```solidity
// Contar reportes por agresor (p√∫blico)
mapping(string => uint256[]) public reportsByAggressor;

// Estad√≠sticas agregadas (privadas/encriptadas)
function getPrivateStatistics() external view returns (bytes memory, bytes memory) {
    return (totalAgeBytes, ageCountBytes);
}
```

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js v18+
- MetaMask instalado
- Cuenta en Sepolia Testnet con ETH de prueba

### 1. Clonar el repositorio

```bash
git clone <repository-url>
cd SmartContractDeployer
```

### 2. Instalar dependencias

```bash
npm install
```

### 3. Configurar variables de entorno

```bash
cp .env.example .env
# Editar .env con tus configuraciones
```

### 4. Compilar contratos

```bash
npx hardhat compile
```

### 5. Ejecutar en desarrollo

```bash
# Iniciar servidor de desarrollo
npm run dev
```

## üì± Uso de la Aplicaci√≥n

### 1. **Conectar Wallet**
- Abrir la aplicaci√≥n en el navegador
- Hacer clic en "Conectar Wallet"
- Autorizar conexi√≥n con MetaMask
- Cambiar a red Sepolia si es necesario

### 2. **Enviar Reporte**
```typescript
// Ejemplo de uso del servicio blockchain
const blockchainService = new BlockchainService();

await blockchainService.submitReport(
  "Nombre Agresor",           // P√∫blico
  "Instituci√≥n",              // P√∫blico  
  "Descripci√≥n del caso",     // P√∫blico
  2024,                      // P√∫blico
  {
    victimAge: encryptedAge,        // Encriptado con FHE
    relationshipType: encryptedRel,  // Encriptado con FHE
    violenceType: encryptedViol,    // Encriptado con FHE
    urgencyLevel: encryptedUrg      // Encriptado con FHE
  }
);
```

### 3. **Ver Estad√≠sticas**
- Dashboard con m√©tricas agregadas
- Gr√°ficos de tendencias (sin revelar datos individuales)
- Detecci√≥n de patrones por agresor

## üîß Configuraci√≥n de Red

### Sepolia Testnet (Producci√≥n)

```javascript
const SEPOLIA_CONFIG = {
  chainId: '0xAA36A7',
  chainName: 'Sepolia Testnet',
  nativeCurrency: {
    name: 'Sepolia ETH',
    symbol: 'ETH',
    decimals: 18
  },
  rpcUrls: ['https://rpc.sepolia.org'],
  blockExplorerUrls: ['https://sepolia.etherscan.io']
};
```

### Desarrollo Local

```bash
# Iniciar nodo Hardhat local
npx hardhat node

# Desplegar contratos localmente
npx hardhat deploy --network localhost
```

## üß™ Testing

### Ejecutar Tests

```bash
# Tests en red mock (r√°pidos)
npx hardhat test

# Tests en red local (con estado persistente)
npx hardhat test --network localhost

# Tests en Sepolia (con encriptaci√≥n real)
npx hardhat test --network sepolia
```

### Verificar Compatibilidad FHEVM

```bash
# Verificar contrato desplegado
npx hardhat fhevm check-fhevm-compatibility --network sepolia --address <CONTRACT_ADDRESS>
```

## üìä Tecnolog√≠as Utilizadas

### Frontend
- **React 18** - Framework de interfaz
- **TypeScript** - Tipado est√°tico
- **Tailwind CSS** - Estilos
- **Ethers.js v6** - Interacci√≥n blockchain
- **React Query** - Estado de servidor

### Blockchain
- **Solidity ^0.8.24** - Smart contracts
- **Hardhat** - Framework de desarrollo
- **FHEVM (@fhevm/solidity)** - Encriptaci√≥n homom√≥rfica
- **Sepolia Testnet** - Red de pruebas

### Backend
- **Express.js** - Servidor API
- **TypeScript** - Tipado est√°tico
- **Drizzle ORM** - Base de datos

## üîí Seguridad y Privacidad

### Caracter√≠sticas de Seguridad

1. **Encriptaci√≥n a Nivel Criptogr√°fico**: Los datos sensibles se encriptan usando FHE antes de enviarse a la blockchain
2. **Zero-Knowledge**: El contrato puede procesar datos sin conocer su contenido real
3. **Inmutabilidad**: Los reportes quedan grabados permanentemente en blockchain
4. **Descentralizaci√≥n**: No hay un punto √∫nico de falla
5. **Anonimato**: Los reporteros pueden mantener su identidad privada

### Consideraciones de Privacidad

- **Datos P√∫blicos**: Nombre del agresor, instituci√≥n, descripci√≥n general
- **Datos Privados**: Edad de v√≠ctima, relaci√≥n, tipo de violencia, urgencia
- **An√°lisis Estad√≠stico**: Posible sobre datos agregados sin revelar casos individuales

## üìà Roadmap

### Versi√≥n Actual (v1.0)
- ‚úÖ Smart contracts b√°sicos
- ‚úÖ Interfaz web funcional
- ‚úÖ Integraci√≥n FHE mock
- ‚úÖ Deploy en Sepolia

### Pr√≥ximas Versiones
- üîÑ **v1.1**: Integraci√≥n completa con fhevmjs
- üìã **v1.2**: Dashboard avanzado de analytics
- üîê **v1.3**: Sistema de permisos granular
- üìä **v2.0**: Machine Learning sobre datos FHE

## ü§ù Contribuir

1. Fork del proyecto
2. Crear branch para feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit de cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push al branch (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para detalles.

## üìû Contacto

Para preguntas sobre el proyecto o colaboraciones, contactar al equipo de desarrollo.

---

**Nota**: Este proyecto utiliza tecnolog√≠a experimental de Zama FHEVM. Para uso en producci√≥n, se recomienda una auditor√≠a completa de seguridad y testing exhaustivo en redes de prueba.